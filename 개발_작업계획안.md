# 경동 조직문화 분석기 — 개발 작업계획안(워크숍 지원판)

본 문서는 다른 AI/개발자가 본 프로젝트를 순차적으로 이어받아 작업할 수 있도록 현재 상태, 목표, 우선순위 로드맵, 세부 작업 지시, 품질 게이트, 실행/검증 방법을 정리한 계획안입니다.

## 1) 목표 및 범위
- 목표: 다중 팀(5~10개 조) 동시 사용 환경에서 안정적으로 “프롬프트 생성 → LLM 결과(JSON) 시각화 → 산출물 저장/관리”가 가능한 경량 웹앱 제공
- 범위: 프런트(React+Vite), 백엔드(FastAPI/Uvicorn), 정적 자산(이미지/베이스라인), 간단한 파일 기반 아티팩트 저장소

## 2) 현재 상태 요약(8/10 적용됨)
- 백엔드(API)
  - `GET /api/spirits` — 동암정신 메타(이미지 경로·레버 좌표 포함)
  - `POST /api/generate-prompt` — 입력(핵심/상세)을 바탕으로 한국어 프롬프트 자동 생성
  - 가벼운 메모리 캐싱 추가(`modules/prompt_generator.py`, TTL 60초)
  - 아티팩트 저장 API 추가(`modules/artifact_store.py`)
    - `POST /api/artifacts`, `GET /api/artifacts`, `GET /api/artifacts/{id}`, `DELETE /api/artifacts/{id}`
  - 프런트 빌드 산출물이 있으면 StaticFiles로 루트("/") 제공(선택적)
- 프런트(React/Vite)
  - `Dashboard.jsx`: 팀/조 이름 입력(선택), 프롬프트/결과에 “저장” 버튼 추가
  - `Visualizer.jsx`: 결과 JSON의 `activated_levers`를 배경 이미지 위에 점으로 표시, baseline 비교 제공
- 스크립트/문서
  - 개발 모드: `run-dev.ps1`
  - 워크숍 모드: `run-prod.ps1`(프런트 빌드 + 백엔드 멀티 워커)
  - `README-RUN.md`에 워크숍/아티팩트 API 설명 반영

주의: `frontend/public/culture_maps/`에 참조되는 PNG 이미지가 아직 누락됨(현재 README.txt만 존재). 시각화 배경 표시를 위해 파일명 일치 이미지 필요.

## 3) 한눈에 보는 아키텍처
- 프런트: Vite Dev(5176) 또는 빌드 후 백엔드 StaticFiles 제공
- 백엔드: FastAPI@127.0.0.1:8000 (/api), 필요 시 멀티 워커
- 프록시: 개발 모드에서 `/api` → 127.0.0.1:8000 (`frontend/vite.config.js`)
- 정적 자산: `frontend/public/culture_maps/*`, `frontend/public/baseline/spirits_baseline.json`
- 데이터: 아티팩트 파일 저장소 `uploads/workshop/`

## 4) 우선순위 로드맵
1. 시각화 이미지 자산 채우기(필수)
2. 아티팩트 목록/불러오기 UI(팀별 필터 및 최근 n개)
3. 레버 좌표 확대(모든 spirit에 적어도 대표 2~3개 좌표)
4. 성능/안정성 강화(워커 수 조정, 캐싱 TTL 설정값화)
5. 테스트/헬스체크(간단 e2e, /healthz 모니터링)
6. 배포 패키징(필요 시 nginx 앞단/https, README 보강)

## 5) 작업 세부 지시(순차 진행)

### 작업 A — 시각화 이미지 자산 보강(필수)
- 목표: `dongam_spirit.json`/`spirits_baseline.json`에서 참조하는 모든 `/culture_maps/*.png`가 존재
- 파일/경로:
  - `frontend/public/culture_maps/*.png`
  - 참조 목록: `backend/modules/dongam_spirit.json`, `frontend/public/baseline/spirits_baseline.json`
- 완료 기준(AC):
  - 프런트 실행 시 Visualizer 배경 이미지가 정상 표시
  - 404/placeholder 메시지 미출현
- 주의: 파일명(한글 포함) 정확히 일치

### 작업 B — 아티팩트 목록/불러오기 UI 추가
- 목표: 프런트에서 저장된 프롬프트/결과를 선택/불러오기 가능(팀명/라벨 기반)
- 수정 파일 제안:
  - `frontend/src/services/api.js`: 기존 list/get API 활용
  - `frontend/src/components/Dashboard.jsx`: 목록 조회/선택 드롭다운 또는 모달 추가
- 기능 요건:
  - 목록 조회: 최신순 n개, 팀명 필터(입력된 teamName와 일치 또는 전체)
  - 항목 선택 시 `llmResult` 영역에 내용 로드(또는 프롬프트 영역)
  - 삭제 버튼(선택 항목 제거) 옵션
- 완료 기준(AC):
  - 저장→목록→선택→불러오기 플로우 동작
  - 에러 핸들링(네트워크 오류 시 메시지)

### 작업 C — 레버 좌표 확대
- 목표: 각 spirit에 최소 2~3개 `levers[].position` 보강으로 풍부한 시각화
- 파일: `backend/modules/dongam_spirit.json`, `frontend/public/baseline/spirits_baseline.json`
- 방법:
  - 기준 좌표계는 약 1000x1000로 가정(코드 내부 baseW/H)
  - 일단 정수 픽셀 좌표로 2~3개 임시값 지정(시각적 배치 확인 후 조정)
- 완료 기준(AC):
  - spirit 선택/결과에 해당 lever_name이 있으면 최소 2곳 이상 점 표시됨

### 작업 D — 성능/안정성 강화 옵션화
- 목표: 캐싱 TTL/워커 수를 설정값으로 분리, 운영 유연성 향상
- 수정 포인트:
  - `modules/prompt_generator.py`: `_TTL_SECONDS`를 환경변수 또는 `.env`/설정값으로 분리
  - 실행 스크립트: `run-prod.ps1`의 `--workers` 값을 파라미터화(기본 2, 선택 4)
- 완료 기준(AC):
  - 환경/옵션만 변경하여 부하 대응 가능

### 작업 E — 테스트/헬스체크
- 목표: 최소 스모크/e2e로 회귀 방지
- 제안:
  - `/healthz` 응답 200 + { ok: true }
  - `/api/spirits` 200 + spirits 배열 길이 > 0
  - `/api/generate-prompt`에 최소 텍스트로 200 + prompt 반환
  - Playwright 간단 시나리오(입력→프롬프트 생성→복사/저장 버튼 클릭)

## 6) 실행/검증 방법(요약)
- 개발 모드:
```pwsh
./run-dev.ps1
```
- 워크숍 모드(추천):
```pwsh
./run-prod.ps1
```
- 기본 확인:
  - 백엔드: `http://127.0.0.1:8000/healthz` → `{ "ok": true }`
  - 프런트: `http://localhost:5176`(dev) 또는 `http://127.0.0.1:8000`(prod)
- 프롬프트/결과 저장 동작:
  - 프롬프트/LLM 결과 입력 후 “저장” 클릭 → 저장 ID 알림
  - 서버 측 저장: `uploads/workshop/` 폴더(본문 파일 + `index.json`)

## 7) 품질 게이트 체크리스트
- 빌드: 프런트 `npm run build` 성공
- 런타임: dev/prod 모두 앱 로드/프롬프트 생성/저장/시각화 OK
- 이미지: 모든 spirit 배경 표시 OK
- API: `/api/spirits`, `/api/generate-prompt`, `/api/artifacts*` 200 OK
- 간단 e2e: 폼 입력→프롬프트 생성→LLM JSON 붙여넣기→시각화

## 8) 운영(워크숍) 체크리스트
- 네트워크/포트 점검(8000, 5176 또는 prod 단일 8000)
- 이미지 자산 존재 확인(`frontend/public/culture_maps/`)
- 저장 공간 확인(`uploads/workshop/` 권한/용량)
- 사전 리허설(2~3 동시 사용자 스모크)

## 9) 파일/디렉토리 안내(핵심)
- 백엔드
  - `backend/app.py` — API/정적 제공/아티팩트 엔드포인트
  - `backend/modules/prompt_generator.py` — 프롬프트 로직 + 캐싱
  - `backend/modules/artifact_store.py` — 파일 기반 저장소
  - `backend/modules/dongam_spirit.json` — spirit 메타(이미지/레버)
- 프런트
  - `frontend/src/components/Dashboard.jsx` — 메인 흐름(UI)
  - `frontend/src/components/Visualizer.jsx` — 시각화
  - `frontend/src/services/api.js` — API 호출
  - `frontend/public/culture_maps/*` — 배경 이미지(필수)
  - `frontend/public/baseline/spirits_baseline.json` — 기준점
- 실행 스크립트/문서
  - `run-dev.ps1`, `run-prod.ps1`, `README-RUN.md`

## 10) 리스크/롤백 전략
- 이미지 미존재 시: 시각화는 placeholder 표시(기능은 계속 동작). 이미지 추가로 즉시 해소
- 파일 저장소 손상 시: `uploads/workshop/index.json` 백업/재생성(본문 파일은 그대로 유지)
- 포트 충돌: 백엔드 포트 변경 후 프록시/문서 동기화

## 11) 향후 확장 아이디어(선택)
- S3 등 외부 스토리지 연동(아티팩트 공유)
- 역할 기반 접근(팀 뷰/관리자 뷰)
- 프롬프트 템플릿 다중화/버전 관리
- i18n(국문/영문 전환)

---
본 계획안에 따라 “작업 A → B → C → D → E” 순으로 진행하세요. 각 단계 완료 시 ‘완료 기준(AC)’를 만족하는지 확인 후 다음 단계로 넘어갑니다. 작업 중 변경된 파일은 본 문서의 경로를 참고해 점진적으로 커밋(작은 단위)하십시오.
